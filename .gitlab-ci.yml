stages:
  - deploy

.filter_script: &filter_script |
    git filter-branch --env-filter '
    OLD_EMAIL="jlcastrillon91@gmail.com"
    CORRECT_NAME="Harlow Fres"
    CORRECT_EMAIL="harlow.fres@gmail.com"
    if [ "$GIT_COMMITTER_EMAIL" = "$OLD_EMAIL" ]
    then
        export GIT_COMMITTER_NAME="$CORRECT_NAME"
        export GIT_COMMITTER_EMAIL="$CORRECT_EMAIL"
    fi
    if [ "$GIT_AUTHOR_EMAIL" = "$OLD_EMAIL" ]
    then
        export GIT_AUTHOR_NAME="$CORRECT_NAME"
        export GIT_AUTHOR_EMAIL="$CORRECT_EMAIL"
    fi
    ' --tag-name-filter cat -- --branches --tags

.push_script: &push_script |
    for remote in `git branch -r`; \
    do \
      git push --force --tags origin HEAD:$(echo $remote | cut -d'/' -f2); \
    done  

before_script:
#  - git remote set-url origin https://lovecraft:${CI_PUSH_TOKEN}@gitlab.com/$CI_PROJECT_PATH.git
  - git remote set-url origin https://jlcastrillon91:6f625cad3c9c2d88ef56e5d5daf0e3f5c624c22f@github.com/jlcastrillon91/client-repository.git
  - git config --global user.email 'harlow.fres@gmail.com'
  - git config --global user.name 'Harlow Fres'

change_authors:
  stage: deploy
  script:
    - *filter_script
    - *push_script
  only:
    - master

